<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Controle de Calorias</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:Arial;background:#f6f6f6;padding:16px}
h1{color:#ff4d88}
label{display:block;margin-top:12px;font-weight:700}
select,input,button{width:100%;padding:8px;margin-top:4px}
button{background:#ff4d88;color:#fff;border:0;border-radius:6px;margin-top:16px}
.card{background:#fff;padding:16px;border-radius:8px}
</style>
</head>
<body>

<h1>üçé Calorias</h1>

<div class="card">
<label>Data</label>
<input type="date" id="data">

<label>Refei√ß√£o</label>
<select id="refeicao">
<option>Caf√© da manh√£</option>
<option>Almo√ßo</option>
<option>Lanche</option>
<option>Janta</option>
</select>

<label>Categoria</label>
<select id="categoria"></select>

<label>Alimento</label>
<select id="alimento"></select>

<label>Quantidade</label>
<input type="number" id="qtd">

<button>Salvar</button>
</div>

<script>
const SHEET_ID = "1YTMNBLzRi5p-uGSPba2FXsoxMeIWyPif";
const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=BD`;

let bd = [];

fetch(URL)
.then(r=>r.text())
.then(t=>{
 const j = JSON.parse(t.substring(47).slice(0,-2));
 const rows = j.table.rows;

 bd = rows.map(r=>({
   descricao: r.c[0]?.v || "",
   calorias: Number(r.c[1]?.v) || 0,
   peso: Number(r.c[2]?.v) || 0,
   unidade: r.c[3]?.v || "",
   tipo: r.c[4]?.v || ""
 })).filter(x=>x.descricao);

 carregarCategorias();
});

function carregarCategorias(){
 const s = document.getElementById("categoria");
 s.innerHTML="";
 [...new Set(bd.map(x=>x.tipo))].forEach(t=>{
  const o=document.createElement("option");
  o.text=t;
  s.add(o);
 });
 s.onchange=carregarAlimentos;
 carregarAlimentos();
}

function carregarAlimentos(){
 const cat=document.getElementById("categoria").value;
 const s=document.getElementById("alimento");
 s.innerHTML="";
 bd.filter(x=>x.tipo===cat).forEach(a=>{
  const o=document.createElement("option");
  o.text=a.descricao+" ("+a.unidade+")";
  s.add(o);
 });
}

document.getElementById("data").valueAsDate=new Date();
</script>

</body>
</html>
