<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Calorias App</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#f2f2f2;
  padding:16px;
  font-size:18px;
}
h1{
  text-align:center;
  font-size:26px;
}
.card{
  background:#fff;
  padding:16px;
  margin-bottom:16px;
  border-radius:14px;
}
label{
  display:block;
  margin-top:12px;
  font-weight:600;
}
select,input,button{
  width:100%;
  padding:12px;
  margin-top:6px;
  font-size:18px;
  border-radius:10px;
  border:1px solid #ccc;
}
button{
  background:#e91e63;
  color:#fff;
  border:none;
  margin-top:20px;
  font-size:20px;
}
.resumo p{
  margin:6px 0;
}
hr{
  margin:10px 0;
}
</style>
</head>

<body>

<h1>üçé Controle de Calorias</h1>

<!-- RESUMO -->
<div class="card resumo">
  <p><strong>Total di√°rio:</strong> 1510 kcal</p>
  <p>‚úÖ Consumidas: <span id="consumidas">0</span></p>
  <p>üî• Restantes: <span id="restantes">1510</span></p>
  <hr>
  <p>ü•© Prote√≠nas: <span id="prot">0</span></p>
  <p>üçö Carboidratos: <span id="carb">0</span></p>
  <p>ü•ë Gorduras: <span id="gord">0</span></p>
</div>

<!-- FORMUL√ÅRIO -->
<div class="card">

<label>Data</label>
<input type="date" id="data">

<label>Refei√ß√£o</label>
<select id="refeicao">
  <option>Caf√© da manh√£</option>
  <option>Almo√ßo</option>
  <option>Lanche</option>
  <option>Janta</option>
</select>

<label>Tipo nutricional</label>
<select id="tipo" onchange="carregarAlimentos()">
  <option value="">Selecione</option>
</select>

<label>Alimento</label>
<select id="alimento" onchange="atualizarUnidade()"></select>

<label id="lblQtd">Quantidade</label>
<input type="number" id="qtd" placeholder="Informe a quantidade">

<button onclick="salvar()">Salvar</button>

</div>

<script>
/* CONFIG */
const TOTAL_DIARIO = 1510;
let bd = [];

let total = 0;
let prot = 0;
let carb = 0;
let gord = 0;

/* DATA PADR√ÉO = HOJE */
document.getElementById("data").valueAsDate = new Date();

/* BUSCA DA ABA BD */
fetch("https://opensheet.elk.sh/1YTMNBLzRi5p-uGSPba2FXsoxMeIWyPif/BD")
.then(r => r.json())
.then(dados => {
  bd = dados.map(l => ({
    descricao: l["descri√ß√£o"],
    cal: Number(l["calorias por grama"]),
    und: l["und"],
    tipo: l["tipo"]
  }));
  carregarTipos();
});

/* TIPOS NUTRICIONAIS */
function carregarTipos(){
  const tipos = [...new Set(bd.map(a => a.tipo))];
  const select = document.getElementById("tipo");
  tipos.forEach(t => {
    const opt = document.createElement("option");
    opt.value = t;
    opt.textContent = t;
    select.appendChild(opt);
  });
}

/* ALIMENTOS POR TIPO */
function carregarAlimentos(){
  const tipo = document.getElementById("tipo").value;
  const select = document.getElementById("alimento");
  select.innerHTML = "";

  bd.filter(a => a.tipo === tipo).forEach(a => {
    const opt = document.createElement("option");
    opt.textContent = a.descricao;
    opt.dataset.und = a.und;
    select.appendChild(opt);
  });

  atualizarUnidade();
}

/* UNIDADE DIN√ÇMICA */
function atualizarUnidade(){
  const sel = document.getElementById("alimento");
  if(!sel.options.length) return;
  const und = sel.options[sel.selectedIndex].dataset.und;
  document.getElementById("lblQtd").innerText =
    "Quantidade (" + und + ")";
}

/* SALVAR */
function salvar(){
  const tipo = document.getElementById("tipo").value.toLowerCase();
  const qtd = Number(document.getElementById("qtd").value);
  const idx = document.getElementById("alimento").selectedIndex;

  if(!tipo || qtd <= 0 || idx < 0){
    alert("Preencha todos os campos corretamente");
    return;
  }

  const alimento = bd.filter(a => a.tipo.toLowerCase() === tipo)[idx];
  const calorias = qtd * alimento.cal;

  total += calorias;

  if(tipo.includes("prote")) prot += calorias;
  else if(tipo.includes("carb")) carb += calorias;
  else if(tipo.includes("gord")) gord += calorias;

  document.getElementById("consumidas").innerText = total.toFixed(1);
  document.getElementById("restantes").innerText =
    (TOTAL_DIARIO - total).toFixed(1);

  document.getElementById("prot").innerText = prot.toFixed(1);
  document.getElementById("carb").innerText = carb.toFixed(1);
  document.getElementById("gord").innerText = gord.toFixed(1);

  document.getElementById("qtd").value = "";
}
</script>

</body>
</html>
