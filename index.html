<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Calorias</title>

<style>
body{
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background:#f4f4f4;
  padding:16px;
  font-size:18px;
}

h1{
  text-align:center;
  font-size:24px;
}

.card{
  background:#fff;
  padding:16px;
  margin-bottom:16px;
  border-radius:12px;
}

label{
  margin-top:12px;
  display:block;
  font-weight:600;
}

select,input,button{
  width:100%;
  padding:12px;
  font-size:18px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  background:#e91e63;
  color:#fff;
  border:none;
  font-size:20px;
  margin-top:20px;
}
.resumo p{
  margin:6px 0;
}
</style>
</head>

<body>

<h1>üçé Controle de Calorias</h1>

<!-- RESUMO -->
<div class="card resumo">
  <p><strong>Total di√°rio:</strong> 1510 kcal</p>
  <p>‚úÖ Consumidas: <span id="totalConsumido">0</span></p>
  <p>üî• Restantes: <span id="totalRestante">1510</span></p>
  <hr>
  <p>ü•© Prote√≠nas: <span id="prot">0</span> kcal</p>
  <p>üçö Carboidratos: <span id="carb">0</span> kcal</p>
  <p>ü•ë Gorduras: <span id="gord">0</span> kcal</p>
</div>

<!-- FORM -->
<div class="card">

<label>Data</label>
<input type="date" id="data">

<label>Refei√ß√£o</label>
<select id="refeicao">
  <option>Caf√© da manh√£</option>
  <option>Almo√ßo</option>
  <option>Lanche</option>
  <option>Janta</option>
</select>

<label>Tipo nutricional</label>
<select id="tipo" onchange="carregarAlimentos()">
  <option value="">Selecione</option>
</select>

<label>Alimento</label>
<select id="alimento" onchange="atualizarUnidade()"></select>

<label id="lblQtd">Quantidade</label>
<input type="number" id="qtd">

<button onclick="salvar()">Salvar</button>

</div>

<script>
const TOTAL = 1510;
let bd = [];

let total = 0;
let prot = 0;
let carb = 0;
let gord = 0;

document.getElementById("data").valueAsDate = new Date();

fetch("https://opensheet.elk.sh/1YTMNBLzRi5p-uGSPba2FXsoxMeIWyPif/BD")
.then(r=>r.json())
.then(d=>{
  bd = d.map(l=>({
    descricao:l["descri√ß√£o"],
    cal:Number(l["calorias por grama"]),
    und:l["und"],
    tipo:l["tipo"]
  }));
  carregarTipos();
});

function carregarTipos(){
  const tipos=[...new Set(bd.map(a=>a.tipo))];
  const s=document.getElementById("tipo");
  tipos.forEach(t=>{
    let o=document.createElement("option");
    o.value=t;
    o.text=t;
    s.appendChild(o);
  });
}

function carregarAlimentos(){
  const tipo=document.getElementById("tipo").value;
  const s=document.getElementById("alimento");
  s.innerHTML="";
  bd.filter(a=>a.tipo===tipo).forEach(a=>{
    let o=document.createElement("option");
    o.text=a.descricao;
    o.dataset.und=a.und;
    s.appendChild(o);
  });
  atualizarUnidade();
}

function atualizarUnidade(){
  const sel=document.getElementById("alimento");
  if(!sel.options.length) return;
  const und=sel.options[sel.selectedIndex].dataset.und;
  document.getElementById("lblQtd").innerText="Quantidade ("+und+")";
}

function salvar(){
  const tipo=document.getElementById("tipo").value;
  const qtd=Number(document.getElementById("qtd").value);
  const idx=document.getElementById("alimento").selectedIndex;

  if(!tipo || qtd<=0 || idx<0){
    alert("Preencha tudo corretamente");
    return;
  }

  const alimento=bd.filter(a=>a.tipo===tipo)[idx];
  const cal=qtd*alimento.cal;

  total+=cal;
  if(tipo.toLowerCase().includes("prote")) prot+=cal;
  if(tipo.toLowerCase().includes("carb")) carb+=cal;
  if(tipo.toLowerCase().includes("gord")) gord+=cal;

  document.getElementById("totalConsumido").innerText=total.toFixed(1);
  document.getElementById("totalRestante").innerText=(TOTAL-total).toFixed(1);
  document.getElementById("prot").innerText=prot.toFixed(1);
  document.getElementById("carb").innerText=carb.toFixed(1);
  document.getElementById("gord").innerText=gord.toFixed(1);

  document.getElementById("qtd").value="";
}
</script>

</body>
</html>
